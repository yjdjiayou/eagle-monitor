{"version":3,"file":"bundle.umd.js","sources":["../../../../eagle-sdk/perf.js","../../../../eagle-sdk/util.js","../../../../eagle-sdk/resources.js","../../../../eagle-sdk/errorCatch.js","../../../../eagle-sdk/xhr.js","../../../../eagle-sdk/util/xpath.js","../../../../eagle-sdk/behavior.js","../../../../eagle-sdk/index.js"],"sourcesContent":["// https://developer.mozilla.org/zh-CN/docs/Web/API/PerformanceTiming\n/**\n * 性能监控\n */\n\nlet perf = {\n  init: (cb) => {\n    let cycleFreq = 100; // 循环轮询的时间\n    let isDOMReady = false;\n    let isOnload = false;\n    let performance = window.performance || window.mozPerformance || window.msPerformance || window.webkitPerformance;\n\n    let Util = {\n      addEventListener: function (name, callback, useCapture) {\n        if (window.addEventListener) {\n          return window.addEventListener(name, callback, useCapture);\n        } else if (window.attachEvent) {\n          return window.attachEvent('on' + name, callback);\n        }\n      },\n\n      domready: function (callback) {\n        if ( isOnload === true ) { return void 0; }\n        let timer = null;\n\n        // interactive:DOM 树解析完成，但是仍在加载子资源，例如图像，样式表和框架\n        if ( document.readyState === 'interactive' ) {\n          runCheck();\n        } else if (document.addEventListener) {\n          // perfData.domReady = timing.domContentLoadedEventStart - timing.navigationStart\n          // performance.timing.domContentLoadedEventStart：发生 DOMContentLoaded 事件的时间，即开始加载网页内资源的时间\n          // performance.timing.domContentLoadedEventEnd：DOMContentLoaded 事件已经发生且执行完所有事件处理程序的时间，网页内资源加载完成的时间\n          // 因为 DOMContentLoaded 是在两个时间中间执行的，无法获取 performance.timing.domContentLoadedEventEnd\n          // 所以只能用 timing.domContentLoadedEventStart 去减 timing.navigationStart\n          document.addEventListener('DOMContentLoaded', function () {\n            runCheck();\n          }, false);\n\n        } else if (document.attachEvent) {\n          document.attachEvent('onreadystatechange', function () {\n            runCheck();\n          });\n        }\n\n        function runCheck() {\n          // 因为 domInteractive 刚开始的值是 0，需要等到有值时才能去上报，否则时间会是负数\n          // 所以这里需要循环检测\n          if ( performance.timing.domInteractive ) {\n            clearTimeout(timer);\n            callback();\n            isDOMReady = true;\n          } else {\n            timer = setTimeout(runCheck, cycleFreq);\n          }\n        }\n      },\n\n      onload: function (callback) {\n        let timer = null;\n\n        if (document.readyState === 'complete') {\n          runCheck();\n        } else {\n          Util.addEventListener('load', function () {\n            runCheck();\n          }, false);\n        }\n\n        function runCheck() {\n          if ( performance.timing.loadEventEnd ) {\n            clearTimeout(timer);\n            callback();\n            isOnload = true;\n          } else {\n            timer = setTimeout(runCheck, cycleFreq);\n          }\n        }\n      }\n    };\n\n    let reportPerf = function () {\n      if (!performance) {\n        return void 0;\n      }\n\n      // 过滤无效数据；\n      function filterTime(a, b) {\n        return (a > 0 && b > 0 && (a - b) >= 0) ? (a - b) : undefined;\n      }\n\n      // append data from window.performance\n      let timing = performance.timing;\n\n      let perfData = {\n        // 网络建连\n        pervPage: filterTime(timing.fetchStart, timing.navigationStart), // 上一个页面\n        redirect: filterTime(timing.responseEnd, timing.redirectStart), // 页面重定向时间\n        dns: filterTime(timing.domainLookupEnd, timing.domainLookupStart), // DNS查找时间\n        connect: filterTime(timing.connectEnd, timing.connectStart), // TCP建连时间\n        network: filterTime(timing.connectEnd, timing.navigationStart), // 网络总耗时\n\n        // 网络接收\n        send: filterTime(timing.responseStart, timing.requestStart), // 前端从发送到接收到后端第一个返回\n        receive: filterTime(timing.responseEnd, timing.responseStart), // 接受页面时间\n        request: filterTime(timing.responseEnd, timing.requestStart), // 请求页面总时间\n\n        // 前端渲染\n        dom: filterTime(timing.domComplete, timing.domLoading), // dom解析时间\n        loadEvent: filterTime(timing.loadEventEnd, timing.loadEventStart), // loadEvent时间\n        frontend: filterTime(timing.loadEventEnd, timing.domLoading), // 前端总时间\n\n        // 关键阶段\n        load: filterTime(timing.loadEventEnd, timing.navigationStart), // 页面完全加载总时间\n        domReady: filterTime(timing.domContentLoadedEventStart, timing.navigationStart), // domready时间\n        interactive: filterTime(timing.domInteractive, timing.navigationStart), // 可操作时间\n        ttfb: filterTime(timing.responseStart, timing.navigationStart),  // 首字节时间\n      };\n\n      return perfData;\n    };\n\n    Util.domready(function () {\n      let perfData = reportPerf('domready');\n      perfData.type = 'domready';\n      cb(perfData);\n    });\n\n    Util.onload(function () {\n      let perfData = reportPerf('onload');\n      perfData.type = 'onload';\n      cb(perfData);\n    });\n  }\n};\n\nexport default perf;\n","export let noop = () => {};\r\nexport let onload = (cb) => {\r\n  if (document.readyState === 'complete') {\r\n    cb();\r\n  }\r\n  window.addEventListener('load', cb);\r\n};\r\n\r\nexport default {\r\n  noop,\r\n  onload\r\n};\r\n","/**\n * 静态资源监控\n */\n\nimport {onload} from './util.js';\n\n// 过滤无效数据\nfunction filterTime(a, b) {\n  return (a > 0 && b > 0 && (a - b) >= 0) ? (a - b) : undefined;\n}\n\nlet resolvePerformanceTiming = (timing) => {\n  let o = {\n    initiatorType: timing.initiatorType,\n    name: timing.name,\n    duration: parseInt(timing.duration),\n    redirect: filterTime(timing.redirectEnd, timing.redirectStart), // 重定向\n    dns: filterTime(timing.domainLookupEnd, timing.domainLookupStart), // DNS解析\n    connect: filterTime(timing.connectEnd, timing.connectStart), // TCP建连\n    network: filterTime(timing.connectEnd, timing.startTime), // 网络总耗时\n\n    send: filterTime(timing.responseStart, timing.requestStart), // 发送开始到接受第一个返回\n    receive: filterTime(timing.responseEnd, timing.responseStart), // 接收总时间\n    request: filterTime(timing.responseEnd, timing.requestStart), // 总时间\n\n    ttfb: filterTime(timing.responseStart, timing.requestStart), // 首字节时间\n  };\n\n  return o;\n};\n\nlet resolveEntries = (entries) => entries.map(item => resolvePerformanceTiming(item));\n\nlet resources = {\n  init: (cb) => {\n    let performance = window.performance || window.mozPerformance || window.msPerformance || window.webkitPerformance;\n    if (!performance || !performance.getEntries) {\n      return void 0;\n    }\n\n    if (window.PerformanceObserver) {\n      let observer = new window.PerformanceObserver((list) => {\n        try {\n          let entries = list.getEntries();\n          cb(resolveEntries(entries));\n        } catch (e) {\n          console.error(e);\n        }\n      });\n      observer.observe({\n        entryTypes: ['resource']\n      })\n    } else {\n      onload(() => {\n        let entries = performance.getEntriesByType('resource');\n        cb(resolveEntries(entries));\n      });\n    }\n  },\n};\n\nexport default resources;\n","/**\n * 错误上报\n */\n\nlet formatError = (errObj) => {\n  let col = errObj.column || errObj.columnNumber; // Safari Firefox\n  let row = errObj.line || errObj.lineNumber; // Safari Firefox\n  let message = errObj.message;\n  let name = errObj.name;\n\n  let {stack} = errObj;\n  // stack 里面的错误信息是最准确的\n  if (stack) {\n    // urlFirstStack 里面有报错的 url 和位置（行列）\n    let matchUrl = stack.match(/https?:\\/\\/[^\\n]+/);\n    let urlFirstStack = matchUrl ? matchUrl[0] : '';\n    let regUrlCheck = /https?:\\/\\/(\\S)*\\.js/;\n\n    // 获取真正的 URL\n    let resourceUrl = '';\n    if (regUrlCheck.test(urlFirstStack)) {\n      resourceUrl = urlFirstStack.match(regUrlCheck)[0];\n    }\n\n    // 获取真正的行列信息\n    let stackRow = null;// 行\n    let stackCol = null;// 列\n    let posStack = urlFirstStack.match(/:(\\d+):(\\d+)/);\n    if (posStack && posStack.length >= 3) {\n      [, stackRow, stackCol] = posStack;\n    }\n\n    // TODO formatStack\n    return {\n      content: stack,\n      col: Number(col || stackCol),\n      row: Number(row || stackRow),\n      message, name, resourceUrl\n    };\n  }\n\n  return {\n    row, col, message, name\n  }\n};\n\nlet errorCatch = {\n  init: (cb) => {\n    let _originOnerror = window.onerror;\n    window.onerror = (...arg) => {\n      let [errorMessage, scriptURI, lineNumber, columnNumber, errorObj] = arg;\n      // console.log('window 里原始的错误=>',arg);\n      let errorInfo = formatError(errorObj);\n      // console.log(JSON.parse(JSON.stringify(errorInfo)));\n      errorInfo._errorMessage = errorMessage;\n      errorInfo._scriptURI = scriptURI;\n      errorInfo._lineNumber = lineNumber;\n      errorInfo._columnNumber = columnNumber;\n      errorInfo.type = 'onerror';\n      // console.log(JSON.parse(JSON.stringify(errorInfo)));\n      cb(errorInfo);\n      _originOnerror && _originOnerror.apply(window, arg);\n    };\n\n    let _originOnunhandledrejection = window.onunhandledrejection;\n    window.onunhandledrejection = (...arg) => {\n      let e = arg[0];\n      let reason = e.reason;\n      cb({\n        type: e.type || 'unhandledrejection',\n        reason\n      });\n      _originOnunhandledrejection && _originOnunhandledrejection.apply(window, arg);\n    };\n  },\n};\n\nexport default errorCatch;\n","/**\n * ajax 请求监控\n */\n\nlet xhrHook = {\n  //TODO 自身 SDK 的请求无需拦截\n  init: (cb) => {\n    // xhr hook\n    let xhr = window.XMLHttpRequest;\n    // 避免用户使用其他的性能监控脚本，只允许使用我们写的脚本，否则会多次监控，没有什么意义\n    if (xhr._eagle_flag === true) {\n      return void 0;\n    }\n    xhr._eagle_flag = true;\n\n    let _originOpen = xhr.prototype.open;\n    xhr.prototype.open = function (method, url, async, user, password) {\n      // TODO eagle url check\n      this._eagle_xhr_info = {\n        url: url,\n        method: method,\n        status: null\n      };\n      return _originOpen.apply(this, arguments);\n    };\n\n    let _originSend = xhr.prototype.send;\n    xhr.prototype.send = function (value) {\n      let _self = this;\n      this._eagle_start_time = Date.now();\n\n      let ajaxEnd = (event) => () => {\n        if (_self.response) {\n          let responseSize = null;\n          switch(_self.responseType) {\n            case 'json':\n              responseSize = JSON && JSON.stringify(_this.response).length;\n              break;\n            case 'blob':\n            case 'moz-blob':\n              responseSize = _self.response.size;\n              break;\n            case 'arraybuffer':\n              responseSize = _self.response.byteLength;\n            case 'document':\n              responseSize = _self.response.documentElement && _self.response.documentElement.innerHTML && (_self.response.documentElement.innerHTML.length + 28);\n              break;\n            default:\n              responseSize = _self.response.length;\n          }\n          _self._eagle_xhr_info.event = event;\n          _self._eagle_xhr_info.status = _self.status;\n          _self._eagle_xhr_info.success = (_self.status >= 200 && _self.status <= 206) || _self.status === 304;\n          _self._eagle_xhr_info.duration = Date.now() - _self._eagle_start_time;\n          _self._eagle_xhr_info.responseSize = responseSize;\n          _self._eagle_xhr_info.requestSize = value ? value.length : 0;\n          _self._eagle_xhr_info.type = 'xhr';\n          cb(this._eagle_xhr_info);\n        }\n      };\n\n      // TODO eagle url check\n      if (this.addEventListener) {\n        this.addEventListener('load', ajaxEnd('load'), false);\n        this.addEventListener('error', ajaxEnd('error'), false);\n        this.addEventListener('abort', ajaxEnd('abort'), false);\n      } else {\n        let _origin_onreadystatechange = this.onreadystatechange;\n        this.onreadystatechange = function (event) {\n          if (_origin_onreadystatechange) {\n            _originOpen.apply(this, arguments);\n          }\n          if (this.readyState === 4) {\n            ajaxEnd('end')();\n          }\n        };\n      }\n      return _originSend.apply(this, arguments);\n    };\n\n    // fetch hook\n    if (window.fetch) {\n      let _origin_fetch = window.fetch;\n      window.fetch = function () {\n        let startTime = Date.now();\n        let args = [].slice.call(arguments);\n\n        let fetchInput = args[0];\n        let method = 'GET';\n        let url;\n\n        if (typeof fetchInput === 'string') {\n          url = fetchInput;\n        } else if ('Request' in window && fetchInput instanceof window.Request) {\n          url = fetchInput.url;\n          if (fetchInput.method) {\n            method = fetchInput.method;\n          }\n        } else {\n          url = '' + fetchInput;\n        }\n\n        if (args[1] && args[1].method) {\n          method = args[1].method;\n        }\n\n        // TODO eagle check\n        let fetchData = {\n          method: method,\n          url: url,\n          status: null,\n        };\n\n        return _origin_fetch.apply(this, args).then(function(response) {\n          fetchData.status = response.status;\n          fetchData.type = 'fetch';\n          fetchData.duration = Date.now() - startTime;\n          cb(fetchData);\n          return response;\n        });\n      }\n    }\n  }\n};\n\nexport default xhrHook;\n","/**\n * 浏览器检查 html 元素时，右键 => Copy => Copy XPath\n */\n// /html/body/div[2]/ul/li[2]\n\nlet getXpath = (element) => {\n  if (!(element instanceof Element)) {\n    return void 0;\n  }\n\n  if (element.nodeType !== 1) {\n    return void 0;\n  }\n\n  let rootElement = document.body;\n  if (element === rootElement) {\n    return void 0;\n  }\n\n\n  let childIndex = (ele) => {\n    let parent = ele.parentNode;\n    let children = [].slice.call(parent.childNodes).filter(_ => _.nodeType === 1);\n    let i = 0;\n    for (let _i = 0, len = children.length; _i < len; _i++) {\n      if (children[_i] === ele) {\n        i = _i;\n        break;\n      }\n    }\n    return i === 0 ? '' : '[' + i + ']';\n  };\n\n  let xpath = '';\n\n  while (element !== document) {\n    let tag = element.tagName.toLocaleLowerCase();\n    let eleIndex = childIndex(element);\n    xpath = '/' + tag + eleIndex + xpath;\n    element = element.parentNode;\n  }\n\n  return xpath;\n};\n\nexport default getXpath;\n","/**\n * 用户行为检测\n */\n\nimport getXpath from './util/xpath.js';\n\nexport default {\n  init: (cb) => {\n    cb();\n    document.addEventListener('click', (e) => {\n      let xpath = getXpath(e.target);\n      console.log('xpath: ', xpath);\n    }, false);\n  }\n}\n","import perf from './perf.js';\nimport resources from './resources.js';\nimport errorCatch from './errorCatch.js';\nimport xhrHook from './xhr.js';\nimport behavior from './behavior.js';\n\nperf.init((perfData) => {\n  // console.log('perf', perfData);\n});\n\nresources.init((list) => {\n  // console.log('resources', list.length === 1 ? list[0] : list);\n});\n\nerrorCatch.init((err) => {\n  console.log('errorCatch', err);\n});\n\nxhrHook.init((xhrInfo) => {\n  console.log(xhrInfo);\n});\n\nbehavior.init(() => {\n  console.log('behavior init');\n});\n"],"names":["perf","cb","cycleFreq","isOnload","performance","window","mozPerformance","msPerformance","webkitPerformance","Util","name","callback","useCapture","addEventListener","attachEvent","timer","document","readyState","runCheck","timing","domInteractive","setTimeout","loadEventEnd","reportPerf","filterTime","a","b","undefined","perfData","fetchStart","navigationStart","responseEnd","redirectStart","domainLookupEnd","domainLookupStart","connectEnd","connectStart","responseStart","requestStart","domComplete","domLoading","loadEventStart","domContentLoadedEventStart","domready","type","onload","resolvePerformanceTiming","o","initiatorType","parseInt","duration","redirectEnd","startTime","resolveEntries","entries","map","item","resources","getEntries","PerformanceObserver","observer","list","e","error","observe","getEntriesByType","formatError","errObj","col","column","columnNumber","row","line","lineNumber","message","stack","matchUrl","match","urlFirstStack","regUrlCheck","resourceUrl","test","stackRow","stackCol","posStack","length","Number","errorCatch","_originOnerror","onerror","arg","errorMessage","scriptURI","errorObj","errorInfo","_errorMessage","_scriptURI","_lineNumber","_columnNumber","apply","_originOnunhandledrejection","onunhandledrejection","reason","xhrHook","xhr","XMLHttpRequest","_eagle_flag","_originOpen","prototype","open","method","url","async","user","password","_eagle_xhr_info","arguments","_originSend","send","value","_self","_eagle_start_time","Date","now","ajaxEnd","event","response","responseSize","responseType","JSON","stringify","_this","size","byteLength","documentElement","innerHTML","status","success","requestSize","_origin_onreadystatechange","onreadystatechange","fetch","_origin_fetch","args","slice","call","fetchInput","Request","fetchData","then","getXpath","element","Element","nodeType","rootElement","body","childIndex","ele","parent","parentNode","children","childNodes","filter","_","i","_i","len","xpath","tag","tagName","toLocaleLowerCase","eleIndex","target","log","init","err","xhrInfo","behavior"],"mappings":"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"}